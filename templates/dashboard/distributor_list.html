{% extends 'dashboard/index.html' %}
{% block page_body %}
<div class="content mt-3">
            <div class="animated fadeIn">
                <div class="row">

                    <div class="col-md-12" >
                        <div class="card" >
                            <div class="card-header">
                                {% block add_to_list %}
                                    {% if user.netbotuser.permission_group.permission.can_manage_distributors %}
                                <a href="{% url 'distributor:add-dist' %}" class="btn btn-success">Add Distributor</a>
                                {% else %}
                                        Registered Distributors
                                    {% endif %}
                                {% endblock %}
                            </div>
                            <div class="card-body">
                                <table data-toggle="table"
                                       data-search="true"
                                       data-show-toggle="true" data-show-fullscreen="true"
                                       data-show-columns="true"
                                       data-show-columns-toggle-all="true"
                                       class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                        <th>#</th>
                                            {% block table_heads %}

                                            <th>Logo</th>
                                            <th data-sortable="true" >Name</th>
                                            <th data-sortable="true" >Country</th>
                                            <th data-sortable="true" >City/State</th>
                                            <th data-sortable="true" >Main Products</th>
                                            <th data-sortable="true" >Email</th>
                                            <th data-sortable="true" >Phone</th>
                                            <th data-sortable="true" >Current Subscription</th>

                                            {% endblock %}
                                            {% block th_action %}
                                            <th>Actions</th>
                                                {% endblock %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% block table_data %}
                                    {% for dist in distributors %}
                                    <tr>
                                       <td>{{  forloop.counter }}</td>
                                       <td>
                                           {% if dist.logo%}
                                           <img src="{{ dist.logo.url }}" style="max-height: 50px;max-width: 100px;">
                                           {% endif %}
                                       </td>
                                       <td>
                                           {{ dist.name }}
                                       </td>
                                       <td>
                                           {{ dist.country }}
                                       </td>
                                       <td>
                                           {{ dist.state }}
                                       </td>
                                    <td>
                                        {{ dist.category }}
                                    </td>
                                    <td>
                                        {{ dist.email }}
                                    </td>
                                    <td>
                                        {{ dist.phone }}
                                    </td>
                                    <td>
                                        {{ dist.subscription }}
                                    </td>
                                    <td>
                                        <a onclick='return edit_js("{{ dist.id }}","{{ dist.name }}")' class="btn btn-warning" data-toggle="modal" data-target="#edit-modal"> <i class="fa fa-edit"></i></a>
                                        {% if dist.active %}
                                             <a onclick='return delete_js("{{ dist.id }}","{{ dist.name }}")' data-toggle="modal" data-target="#delete-modal" class="btn btn-danger" > <i class="fa fa-trash">DeActivate</i></a>
                                        {% else %}
                                             <a onclick='return delete_js("{{ dist.id }}","{{ dist.name }}")' data-toggle="modal" data-target="#delete-modal" class="btn btn-success" > <i class="fa fa-t">Activate</i></a>
                                        {% endif %}

                                     </td>
                                    </tr>
                                    {% endfor %}
                                        {% endblock %}
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- .animated -->
        </div><!-- .content -->
{% endblock %}


{% block page_modals %}
    {% block delete_dist %}
    <div class="modal fade"  id="delete-modal" role="dialog" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">{% block del_md_tittle %}Deactivate Distributor{% endblock %}</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <form method="post" id="form-delete-modal" action="" class="form form-row">
                    {% csrf_token %}
                    <input type="hidden" name="id" value="0" id="del_id">
                    <input type="hidden" name="action" value="delete" >
                    <div class="modal-body delete-canvas">
                        <h3 id="del__name"></h3>
                        <h3 class="text-danger">{% if distributors %}The Distributors' state of operation Will Change{% else %}Please Note That This Action Is Irreversible{% endif %}</h3>
                        <h3 class="text-danger">Continue?</h3>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-primary" data-dismiss="modal" >Cancel</button>
                        {% if distributors %}
                            <button type="submit"  class="btn btn-warning"><i ></i>Yes</button>
                        {% else %}
                            <button type="submit"  class="btn btn-danger"><i  class="fa fa-trash"></i>Delete</button>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endblock %}


<div class="modal fade" id="edit-modal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">{% block  edit_md_title  %} Edit Distributor{% endblock %}</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <form method="post" enctype="multipart/form-data" id="form-edit-group" action="{% block edit_action %}{% url 'distributor:add-dist' %}{% endblock %}">
            <div class="modal-body edit-canvas">
                    <h3 id="edit__name"></h3>
                <input id="edit__id" name="id" value="0" type="hidden">
                {% csrf_token %}
                <div id="form_body">


                </div>

                <div class="modal-footer">
                    <button class="btn btn-warning" data-dismiss="modal">Cancel</button>
                    <button type="submit" id="btn-edit-token" class="btn btn-success"><i id="sync-bt1" class="fa fa-save"></i>Update
                    </button>
                </div>
            </div>
            </form>
        </div>
    </div>
</div>






{% endblock %}

{% block addJs %}
<script type="application/javascript">
    function edit_js(edit_id,edit_name){
        jQuery('#edit__id').val(edit_id);
        jQuery('#edit__name').html(edit_name);

        var formData = {
            'csrfmiddlewaretoken': jQuery('input[name=csrfmiddlewaretoken]').val(),
            'id'             : edit_id,
            'action'    : 'edit'
        };
        jQuery.ajax({
                    type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
                    url         : '', // the url where we want to POST
                    data        : formData, // our data object
                }).done(function(data) {
                        console.log(data);
                        jQuery('#form_body').html(data);
                        // here we will handle errors and validation messages
                    });
    }

function delete_js(del_id,del_name){
    jQuery('#del_id').val(del_id);
    jQuery('#del__name').html(del_name);
    jQuery('#form-delete-modal').submit(function (e){
         var formData = {
             'csrfmiddlewaretoken': jQuery('input[name=csrfmiddlewaretoken]').val(),
            'id'             : jQuery('input[name=id]').val(),
            'action'    : jQuery('input[name=action]').val()
        };

        // process the form
        jQuery.ajax({
            type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
            url         : '', // the url where we want to POST
            data        : formData, // our data object
            dataType    : 'json', // what type of data do we expect back from the server
                        encode          : true
        })
            // using the done promise callback
            .done(function(data) {

                // log data to the console so we can see
                console.log(data);
                Swal.fire(
                    data.title,
                    data.message,
                    data.icon
                );
                if(data.icon=='success'){
                    location.reload();
                }
                // here we will handle errors and validation messages
            });
       e.preventDefault();

    });


}

function view_g(group_id){

}
</script>
{% endblock %}

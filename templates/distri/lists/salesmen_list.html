{% extends 'distri/index.html' %}
{% block page_body %}
    <input type="hidden" name="assign_url" id="assign_url" value="">
<div class="content mt-3">
            <div class="animated fadeIn">
                <div class="row">

                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
{#                                <strong class="card-title">{% block table_title %}Salesmen{% endblock %}</strong>#}
                                {% block add_obj_url %}
                                    <a class="btn btn-success fa fa-plus-square" href="{% url 'distributor:dist-salesmen-add' distributor.id distributor.name %}">&nbsp; Add Sales Person</a>
                                {% endblock %}
                            </div>

                            <div class="card-body">
                            {% block table %}
                                <table data-toggle="table"
                                       data-search="true"
                                       data-show-toggle="true" data-show-fullscreen="true"
                                       data-show-columns="true"
                                       data-show-columns-toggle-all="true"
                                       class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            {% block table_heads %}
                                            <th data-searchable="false">#</th>
                                            <th data-sortable="true">Name</th>
                                            <th data-sortable="true">Phone</th>
                                            <th data-sortable="true">Email</th>
                                            <th data-sortable="true"  data-searchable="false">Assigned Retailers</th>
                                            <th data-searchable="false">Actions</th>
                                            {% endblock %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% block table_data %}
                                    {% for salesman  in salesmen %}
                                    <tr>
                                       <td>{{  forloop.counter }}</td>
                                       <td>
                                           {{ salesman.first_name }} {{ salesman.last_name }}
                                       </td>
                                       <td>
                                           {{ salesman.phone }}
                                       </td>
                                       <td>
                                           {{ salesman.email }}
                                       </td>
                                    <td>
                                        <button type="button" data-toggle="modal" data-target="#assign_ret" onclick="assignRetailers('{% url 'distributor:dist-assigned_retailers' distributor.id distributor.name salesman.id %}')" class="btn btn-warning">Assigned Retailers</button>
                                        {{ salesman.retailers.all|length }}
                                    </td>
                                    <td>
                                         {% include 'distri/modals/actions.html' with id=salesman.id name=salesman.last_name %}

                                    </td>
                                    </tr>
                                    {% endfor %}
                                        {% endblock %}
                                    </tbody>

                                </table>
                                {% endblock %}
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- .animated -->
        </div><!-- .content -->
{% endblock %}

{% block page_modals %}
<div class="modal fade"  id="delete-modal" role="dialog" >
    <div class="modal-dialog modal-lg">
        <div class="modal-content">


            <div class="modal-header">
                <h4 class="modal-title">{% block del_md_tittle %}Delete Salesman{% endblock %}</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
<form method="post" id="form-delete-modal" action="" class="form form-row">
    {% csrf_token %}
    <input type="hidden" name="id" value="0" id="del_id">
    <input type="hidden" name="action" value="delete" >
            <div class="modal-body delete-canvas">
                <h3 id="del__name"></h3>
                 <h3 class="text-danger">Please Note That  This Action is irreversible</h3>

            </div>

            <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal" >Cancel</button>
                <button type="submit"  class="btn btn-danger"><i  class="fa fa-trash"></i>Delete</button>
            </div>
            </form>
        </div>
    </div>
</div>




<div class="modal fade" id="edit-modal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">{% block  edit_md_title  %}Edit SalesMan{% endblock %}</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <form method="post" {% block enc_type %}{% endblock %} id="form-edit-group" action="{% block edit_action %}{% url 'distributor:dist-salesmen-add' distributor.id distributor.name %}{% endblock %}">
           <div class="modal-body edit-canvas">
                <h3 id="edit__name"></h3>
               <input id="edit__id" name="id" value="0" type="hidden">
               {% csrf_token %}
             <div id="form_body">


            </div>

            <div class="modal-footer">
                <button class="btn btn-warning" data-dismiss="modal">Cancel</button>
                <button type="submit" id="btn-edit-token" class="btn btn-success"><i id="sync-bt1" class="fa fa-save"></i>Update
                </button>
            </div>
           </div>
 </form>
        </div>
    </div>
</div>


{% block moreModals %}
<div class="modal fade" id="assign_ret" role="dialog">

<div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Assign Retailers</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <div class="modal-body" id="retailers_body">

            </div>
            <div class="modal-footer">
{#                <button class="btn btn-success" data-dismiss="modal">Assign All Selected</button>#}
                <button class="btn btn-warning" data-dismiss="modal">ok</button>
            </div>
        </div>
</div>
</div>
{% endblock %}

{% endblock %}

{% block addJs %}
    {% block moreJs %}
    {% endblock %}
<script type="application/javascript">
function edit_js(edit_id,edit_name){
jQuery('#edit__id').val(edit_id);
jQuery('#edit__name').html(edit_name);

var formData = {
    'csrfmiddlewaretoken': jQuery('input[name=csrfmiddlewaretoken]').val(),
    'id'             : edit_id,
    'action'    : 'edit'
};
jQuery.ajax({
            type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
            url         : '', // the url where we want to POST
            data        : formData, // our data object
        }).done(function(data) {

                console.log(data);
                jQuery('#form_body').html(data);
                jQuery('#id_color').attr("type",'color');
                // here we will handle errors and validation messages
    });


}

function delete_js(del_id,del_name){
    jQuery('#del_id').val(del_id);
    jQuery('#del__name').html(del_name);
    jQuery('#form-delete-modal').submit(function (e){
         var formData = {
             {#'csrftoken': jQuery('input[name=csrfmiddlewaretoken]').val(),#}
             'csrfmiddlewaretoken': jQuery('input[name=csrfmiddlewaretoken]').val(),
            'id'             : jQuery('input[name=id]').val(),
            'action'    : jQuery('input[name=action]').val()
        };

        // process the form
        jQuery.ajax({
            type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
            url         : '', // the url where we want to POST
            data        : formData, // our data object
            dataType    : 'json', // what type of data do we expect back from the server
            encode          : true
        })
            // using the done promise callback
            .done(function(data) {

                // log data to the console so we can see
                {#console.log(data);#}
                Swal.fire(
                    data.title,
                    data.message,
                    data.icon
                );
                if(data.icon=='success'){
                    location.reload();
                }
                // here we will handle errors and validation messages
            });
       e.preventDefault();

    });


}

function view_g(group_id){

}

function assignRetailers(ret_url){
jQuery.ajax({
            type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
            url         : ret_url, // the url where we want to POST
            data        : {'er':"ie"}, // our data object
        }).done(function(data) {
            {#alert("Hello");#}
                console.log(data);
                jQuery('#retailers_body').html(data);
                jQuery('#assign_url').val(ret_url);
                jQuery('#retail_assign').bootstrapTable();

                // here we will handle errors and validation messages
    });
}
function as_rm(id,action){
    var formData = {
        'csrfmiddlewaretoken': jQuery('input[name=csrfmiddlewaretoken]').val(),
        'ret_id'    : id,
        'action':action
        };

        // process the form
        jQuery.ajax({
            type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
            url         : jQuery('#assign_url').val(), // the url where we want to POST
            data        : formData, // our data object
            dataType    : 'json', // what type of data do we expect back from the server
            encode      : true
        })
            // using the done promise callback
            .done(function(data) {

                // log data to the console so we can see
                {#console.log(data);#}
                {#Swal.fire(#}
                {#    data.title,#}
                {#    data.message,#}
                {#    data.icon#}
                {#);#}
                if(data.icon=='success'){
                    assignRetailers(jQuery('#assign_url').val());
                }
                // here we will handle errors and validation message
                });
}

</script>
{% endblock %}
{% extends 'NewTheme/base.html' %} {% load static %} {% block content %}



<div class="row mt-0 justify-content-center">
    <div class="col-12">
        <!-- Recent Order Table -->
        <div class="card" id="recent-orders">
            <div class="card-header justify-content-between pt-2">

                <div class="d-flex align-items-center justify-content-between mt-0">
                    <span class='text-primary' style='font-size: 40px;'> <i class="mdi mdi-account-group"></i> Distributors  &nbsp;</span>
                    <span>
                    {% if user.netbotuser.permission_group.permission.can_manage_distributors %}
                    <a type="button" style="margin-top:-15px;" class="btn btn-primary btn-pill text-light" data-style="contract" href="{% url 'distributor:add-dist' %}">
                        <span class="ladda-label"><i class='mdi mdi-plus'></i> Add Distributor</span>
                    </a>
                    {% else %} Registered Distributors {% endif %}
                    </span>
                </div>
                <p class='text-right mt-1 mr-5'>
                    Status:
                    <span class="ml-3"><i class="fa fa-dot-circle-o text-success" aria-hidden="true"></i></span> - Active
                    <span class="ml-3"><i class="fa fa-dot-circle-o text-danger" aria-hidden="true"></i> - Inactive</span>
                </p>
            </div>

            <hr class="separator bg-secondary">

            <div class="card-body " style="width:100%;">
                <table data-toggle="table" style="width:100%;" data-search="true" data-pagination="true" data-page-list="[5,10, 25, 50, 100, all]" data-show-export="true" data-show-toggle="true" data-show-fullscreen="true" data-show-columns="true" data-show-columns-toggle-all="true"
                    data-minimum-count-columns="10" data-id-field="id" class="table table-striped table-borderless ">

                    <thead class="bg-primary text-center p-0 ">
                        <tr>
                            <th data-sortable="true" class="text-light">#</th>
                            <th data-sortable="true" class="text-light">Logo</th>
                            <th data-sortable="true" class="text-light">Name</th>
                            <th data-sortable="true" class="text-light">Country</th>
                            <th data-sortable="true" class="text-light">City/State</th>
                            <th data-sortable="true" class="text-light">Main Product</th>
                            <th data-sortable="true" class="text-light">Email</th>
                            <th data-sortable="true" type="String" class="text-light">Phone</th>
                            <th data-sortable="true" class="text-light">Current Subscription</th>
                            <th data-sortable="true" class="text-light">Contact Persons</th>
                            <th data-sortable="true" class="text-light">Contact Person Phone</th>
                            <th data-sortable="true" class="text-light">Chained Retailer</th>
                            <th data-sortable="true" class="text-light">Status</th>
                            <th data-sortable="true" class="text-light">Actions</th>
                        </tr>
                    </thead>
                    <tbody class='tbody-sm p-0'>
                        {% for dist in distributors %}
                        <tr class='text-center table-bordered p-0'>
                            <td class='table-bordered'>{{ forloop.counter }}</td>
                            <td class='table-bordered'>
                                {% if dist.logo%}
                                <img src="{{ dist.logo.url }}" style="max-width: 100%; max-height:100%; object-fit: contain; "> {% endif %}
                            </td>
                            <td class="table-bordered "><a href="{% url 'distributor:distributor_details' dist.id %}">{{ dist.name }}</a> </td>
                            <td class="table-bordered">{{ dist.country }}</td>
                            <td class="table-bordered">{{ dist.state }}</td>
                            <td class="table-bordered">{{ dist.category|truncatechars:9}}</td>
                            <td class="table-bordered">{{ dist.email }}</td>
                            <td class="table-bordered">{{ dist.phone }}</td>
                            <td><small class="badge badge-success">{{ dist.subscription }}</small></td>
                            <td class="table-bordered">{{ dist.contact_person }}</td>
                            <td class="table-bordered">{{ dist.contact_phone }}</td>
                            <td class="d-none d-sm-table-cell">{{dist.ret_distributors.all|length}}</td>
                            <td>
                                {% if dist.active %}
                                <small class="text-success"> <i class="fa fa-dot-circle-o text-success" aria-hidden="true"></i> </small> {% else %}
                                <small class="text-danger"><i class="fa fa-dot-circle-o text-danger" aria-hidden="true"></i> </small> {% endif %}
                            </td>
                            <td class="text-left">
                                {% if user.netbotuser.permission_group.permission.can_manage_distributors %}
                                <li class="dropdown-item">
                                    <a href='{% url "distributor:editDistributor" dist.id %}' class="btn btn-sm btn-primary text-white" title="Edit"> <i class="fa fa-edit "></i> </a>

                                    {% if dist.active %}
                                    <a onclick='return delete_js("{{ dist.id }}","{{ dist.name }}")' data-toggle="modal" data-target="#delete-modal" class="btn btn-sm btn-danger text-white" title="Deactivate"> <i class="fa fa-remove"> </i></a>
                                    {% else %}
                                    <a onclick='return delete_js("{{ dist.id }}","{{ dist.name }}")' data-toggle="modal" data-target="#delete-modal2" class="btn btn-sm btn-success text-white" title="Activate"> <i class="fa fa-check"> </i></a>
                                    {% endif %}
                                    <a onclick='return edit_js("{{ dist.id }}","{{ dist.name }}")' class=" btn btn-sm btn btn-sm btn-warning text-white" title="Resend Logins"> <i class="fa fa-refresh ">$</i></a>
                                </li>
                                </ul>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>


            </div>
        </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>




{% endblock %} {% block page_modals %} {% block delete_dist %}
<div class="modal fade" id="delete-modal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title text-danger">{% block del_md_tittle %} <i class="fa fa-warning"></i> Deactivate Distributor - <span id="del__name"></span>{% endblock %}</h3>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form method="post" id="form-delete-modal" action="" class="form form-group form-row">
                {% csrf_token %}
                <input type="hidden" name="id" value="0" id="del_id">
                <input type="hidden" name="action" value="delete">
                <div class="modal-body delete-canvas">
                    <h5 class="text-secondary">
                        {% if distributors %} On clicking on 'Deactivate' you wil be deactivating this distributor!! {% else %} Please Note That This Action Is Irreversible {% endif %}
                    </h5> <br>
                    <h6 class="text-secondary content-justify-center">Do you wish to Continue?</h6>
                </div>

                <div class="modal-footer w-100 d-flex justify-content-end">
                    <button class="btn btn-primary text-light" data-dismiss="modal">Cancel</button> {% if distributors %}
                    <button type="submit" class="btn btn-danger text-light"><i ></i>Deactivate</button> {% else %}
                    <button type="submit" class="btn btn-danger text-light"><i  class="fa fa-trash"></i> Delete</button> {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="delete-modal2" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title text-primary"><i class="fa fa-check-square-o"></i> Activate Distributor - <span id="del__name2"></span></h3>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form method="post" id="form-delete-modal2" action="" class="form form-group form-row">
                {% csrf_token %}
                <input type="hidden" name="id" value="0" id="del_id2">
                <input type="hidden" name="action" value="delete">
                <div class="modal-body delete-canvas">
                    <h5 class="text-secondary">
                        {% if distributors %} On clicking on 'Activate' you wil be Activating this distributor!! {% else %} Please Note That This Action Is Irreversible {% endif %}
                    </h5> <br>
                    <h6 class="text-secondary content-justify-center">Do you wish to Continue?</h6>
                </div>

                <div class="modal-footer w-100 d-flex justify-content-end">
                    <button class="btn btn-primary text-light" data-dismiss="modal">Cancel</button> {% if distributors %}
                    <button type="submit" class="btn btn-success text-light"><i ></i>Activate</button> {% else %}
                    <button type="submit" class="btn btn-danger text-light"><i  class="fa fa-trash"></i> Delete</button> {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade " id="edit-modal" role="dialog" style='z-index: 1050'>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title text-primary">
                    {% block edit_md_title %}
                    <i class="fa fa-edit"></i> Edit Distributor - <span id="edit__name"></span> {% endblock %}
                </h2>
                <button type="button" class="close" data-dismiss="modal" style="font-size: 30px;"> <i class="fa fa-times-circle text-danger" aria-hidden="true"></i> </button>
            </div>

            <form method="post" enctype="multipart/form-data" id="form-edit-group" action="{% block edit_action %} {% url 'distributor:add-dist' %} {% endblock %}">
                <div class="modal-body edit-canvas pt-0">

                    <input id="edit__id" name="id" value="0" type="hidden"> {% csrf_token %}
                    <div id="form_body">


                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-danger" data-dismiss="modal">Cancel</button>
                        <button type="submit" id="btn-edit-token" class="btn btn-success"><i id="sync-bt1" class="fa fa-save"></i> Update
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %} {% endblock %} {% block addJs %}

<script type="application/javascript">
    function edit_js(edit_id, edit_name) {
        jQuery('#edit__id').val(edit_id);
        jQuery('#edit__name').html(edit_name);

        var formData = {
            'csrfmiddlewaretoken': jQuery('input[name=csrfmiddlewaretoken]').val(),
            'id': edit_id,
            'action': 'edit'
        };
        jQuery.ajax({
            type: 'POST', // define the type of HTTP verb we want to use (POST for our form)
            url: '', // the url where we want to POST
            data: formData, // our data object
        }).done(function(data) {
            // console.log(data);
            jQuery('#form_body').html(data);
            // here we will handle errors and validation messages
        });
    }

    function delete_js(del_id, del_name) {
        jQuery('#del_id').val(del_id);
        jQuery('#del__name').html(del_name);
        jQuery('#del_id2').val(del_id);
        jQuery('#del__name2').html(del_name);
        jQuery('#form-delete-modal').submit(function(e) {
            var formData = {
                'csrfmiddlewaretoken': jQuery('input[name=csrfmiddlewaretoken]').val(),
                'id': jQuery('input[name=id]').val(),
                'action': jQuery('input[name=action]').val()
            };

            // process the form
            jQuery.ajax({
                    type: 'POST', // define the type of HTTP verb we want to use (POST for our form)
                    url: '', // the url where we want to POST
                    data: formData, // our data object
                    dataType: 'json', // what type of data do we expect back from the server
                    encode: true
                })
                // using the done promise callback
                .done(function(data) {

                    // log data to the console so we can see
                    console.log(data);
                    Swal.fire(
                        data.title,
                        data.message,
                        data.icon
                    );
                    if (data.icon == 'success') {
                        location.reload();
                    }
                    // here we will handle errors and validation messages
                });
            e.preventDefault();

        });
        jQuery('#form-delete-modal2').submit(function(e) {
            var formData = {
                'csrfmiddlewaretoken': jQuery('input[name=csrfmiddlewaretoken]').val(),
                'id': jQuery('input[name=id]').val(),
                'action': jQuery('input[name=action]').val()
            };

            // process the form
            jQuery.ajax({
                    type: 'POST', // define the type of HTTP verb we want to use (POST for our form)
                    url: '', // the url where we want to POST
                    data: formData, // our data object
                    dataType: 'json', // what type of data do we expect back from the server
                    encode: true
                })
                // using the done promise callback
                .done(function(data) {

                    // log data to the console so we can see
                    console.log(data);
                    Swal.fire(
                        data.title,
                        data.message,
                        data.icon
                    );
                    if (data.icon == 'success') {
                        location.reload();
                    }
                    // here we will handle errors and validation messages
                });
            e.preventDefault();

        });


    }
</script>

{% endblock %}